# =====================================
# GLOBAL SETTINGS
# =====================================
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -ag terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[6 q'

# Enable mouse support
set -g mouse on

# Start windows and panes from 1, not 0
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Position status bar at top
set-option status-position top 

# PERFORMANCE SETTINGS
set -s escape-time 0          # Zero-delay for key presses (essential for Vim)
set -g history-limit 50000    # Increase scrollback buffer size
set -g focus-events on        # Needed for 'autoread' to work in Neovim
set -g status-interval 5      # Update status every 5 seconds

# Automatically rename windows based on current directory
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# =====================================
# KEYBINDINGS
# =====================================

# Change prefix to C-a
set -g prefix C-a
unbind C-b
bind-key C-a send-prefix

# Reload config
unbind r
bind r source-file ~/.tmux.conf

# Split windows (intuitive bindings)
unbind %
bind | split-window -h 
unbind '"'
bind - split-window -v

# Vim-style pane resizing
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z

# New window in current path
bind M-c attach-session -c "#{pane_current_path}"

# Vim-style copy mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection 
bind-key -T copy-mode-vi 'y' send -X copy-selection 
unbind -T copy-mode-vi MouseDragEnd1Pane

# =====================================
# Status bar
# =====================================

# --- Base Status Bar Settings ---
set -g status-bg "#1a1b26"
set -g status-fg "#c0caf5"
set -g status-interval 5
set -g status-justify left
set -g status-left-length 100
set -g status-right-length 100
set -g window-status-separator ""

# --- Window Status Format ---
# Inactive window 
set -g window-status-format '#[fg=#414868, bg=#1a1b26]#[fg=#c0caf5, bg=#414868] #I #[fg=#c0caf5, bg=#414868] #[fg=#c0caf5, bg=#414868]#W #[fg=#414868, bg=#1a1b26]'

# Active window
set -g window-status-current-format '#[fg=#bb9af7, bg=#1a1b26]#[fg=#1a1b26, bg=#bb9af7, bold] #I #[fg=#1a1b26, bg=#bb9af7, bold] #[fg=#1a1b26, bg=#bb9af7, bold]#W #[fg=#bb9af7, bg=#1a1b26]'

# --- Status Left ---
set -g status-left '#{?client_prefix,#[fg=#15161e bg=#e0af68 bold] 󰌌 ,#[fg=#15161e bg=#7aa2f7 bold] 󰈸 }#[fg=#7aa2f7, bg=#1a1b26]#{?client_prefix,#[fg=#e0af68],}#[fg=#7aa2f7, bg=#1a1b26, bold] #{session_name} #[fg=#1a1b26, bg=#414868]#[fg=#c0caf5, bg=#414868] 󰓾 PID [#{pane_pid}] #[fg=#414868, bg=#1a1b26]#[fg=#7aa2f7, bg=#1a1b26]'

# --- Status Right ---
set -g status-right '#[fg=#7aa2f7, bg=#1a1b26]#[fg=#414868, bg=#1a1b26]#[fg=#7aa2f7, bg=#414868] 󰍎 ../#(basename "#{pane_current_path}") #[fg=#7aa2f7, bg=#414868]#[fg=#15161e, bg=#7aa2f7, bold]  #h '

# --- Pane Borders ---
# set -g pane-border-style fg="#414868"
# set -g pane-active-border-style fg="#7aa2f7"

# Gray pane borders
set -g pane-active-border-style "bg=default,fg=#585b70"
set -g pane-border-style "bg=default,fg=#585b70"

# --- Message Style ---
set -g message-style fg="#c0caf5",bg="#414868"

# =====================================
# PLUGINS
# =====================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect' 
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
